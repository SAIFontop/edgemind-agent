# EdgeMind Agent - Command Whitelist
# ===================================
# Only commands in this list can be executed
# Each command has a risk level and description

# ═══════════════════════════════════════════
# SYSTEM INFORMATION (Read-Only)
# ═══════════════════════════════════════════
system_info:
  - command: "uname -a"
    risk: "low"
    description: "Display system information"
    
  - command: "hostnamectl"
    risk: "low"
    description: "Display hostname and OS info"
    
  - command: "uptime"
    risk: "low"
    description: "Display system uptime"
    
  - command: "date"
    risk: "low"
    description: "Display current date and time"
    
  - command: "whoami"
    risk: "low"
    description: "Display current user"
    
  - command: "id"
    risk: "low"
    description: "Display user identity"
    
  - command: "cat /etc/os-release"
    risk: "low"
    description: "Display OS release information"

# ═══════════════════════════════════════════
# MEMORY & CPU DIAGNOSTICS
# ═══════════════════════════════════════════
memory_cpu:
  - command: "free -h"
    risk: "low"
    description: "Display memory usage"
    
  - command: "free -m"
    risk: "low"
    description: "Display memory in MB"
    
  - command: "cat /proc/meminfo"
    risk: "low"
    description: "Detailed memory information"
    
  - command: "cat /proc/cpuinfo"
    risk: "low"
    description: "CPU information"
    
  - command: "lscpu"
    risk: "low"
    description: "Display CPU architecture"
    
  - command: "top -bn1 | head -20"
    risk: "low"
    description: "Top processes snapshot"
    
  - command: "ps aux --sort=-%mem | head -10"
    risk: "low"
    description: "Top memory consumers"
    
  - command: "ps aux --sort=-%cpu | head -10"
    risk: "low"
    description: "Top CPU consumers"
    
  - command: "vcgencmd measure_temp"
    risk: "low"
    description: "Raspberry Pi temperature"
    
  - command: "vcgencmd get_throttled"
    risk: "low"
    description: "Check throttling status"

# ═══════════════════════════════════════════
# DISK & STORAGE
# ═══════════════════════════════════════════
disk_storage:
  - command: "df -h"
    risk: "low"
    description: "Display disk usage"
    
  - command: "df -i"
    risk: "low"
    description: "Display inode usage"
    
  - command: "lsblk"
    risk: "low"
    description: "List block devices"
    
  - command: "mount"
    risk: "low"
    description: "Display mounted filesystems"
    
  - command: "findmnt"
    risk: "low"
    description: "Display mount tree"

# ═══════════════════════════════════════════
# NETWORK DIAGNOSTICS
# ═══════════════════════════════════════════
network:
  - command: "ip addr"
    risk: "low"
    description: "Display IP addresses"
    
  - command: "ip route"
    risk: "low"
    description: "Display routing table"
    
  - command: "ifconfig"
    risk: "low"
    description: "Display network interfaces"
    
  - command: "netstat -tuln"
    risk: "low"
    description: "Display listening ports"
    
  - command: "ss -tuln"
    risk: "low"
    description: "Display socket statistics"
    
  - command: "cat /etc/resolv.conf"
    risk: "low"
    description: "Display DNS configuration"
    
  - command: "cat /etc/hosts"
    risk: "low"
    description: "Display hosts file"
    
  - command: "iwconfig"
    risk: "low"
    description: "Display wireless configuration"
    
  - command_pattern: "ping -c 4 {host}"
    risk: "low"
    description: "Ping a host (4 packets)"
    allowed_hosts:
      - "localhost"
      - "127.0.0.1"
      - "8.8.8.8"
      - "1.1.1.1"
      - "google.com"
    
  - command_pattern: "curl -I {url}"
    risk: "medium"
    description: "HTTP HEAD request"
    
  - command_pattern: "wget --spider {url}"
    risk: "medium"
    description: "Check URL availability"

# ═══════════════════════════════════════════
# SERVICE MANAGEMENT (Read)
# ═══════════════════════════════════════════
services_read:
  - command: "systemctl list-units --type=service"
    risk: "low"
    description: "List all services"
    
  - command: "systemctl list-units --type=service --state=running"
    risk: "low"
    description: "List running services"
    
  - command: "systemctl list-units --type=service --state=failed"
    risk: "low"
    description: "List failed services"
    
  - command_pattern: "systemctl status {service}"
    risk: "low"
    description: "Check service status"
    
  - command_pattern: "journalctl -u {service} -n 50"
    risk: "low"
    description: "View service logs"
    
  - command: "systemctl --failed"
    risk: "low"
    description: "List failed units"

# ═══════════════════════════════════════════
# SERVICE MANAGEMENT (Control) - Medium Risk
# ═══════════════════════════════════════════
services_control:
  - command_pattern: "sudo systemctl restart {service}"
    risk: "medium"
    description: "Restart a service"
    requires_confirmation: true
    allowed_services:
      - "ssh"
      - "sshd"
      - "nginx"
      - "apache2"
      - "cron"
      - "networking"
    
  - command_pattern: "sudo systemctl start {service}"
    risk: "medium"
    description: "Start a service"
    requires_confirmation: true
    
  - command_pattern: "sudo systemctl stop {service}"
    risk: "medium"
    description: "Stop a service"
    requires_confirmation: true

# ═══════════════════════════════════════════
# LOG VIEWING (Read-Only)
# ═══════════════════════════════════════════
logs:
  - command: "tail -n 50 /var/log/syslog"
    risk: "low"
    description: "View recent syslog entries"
    
  - command: "tail -n 50 /var/log/auth.log"
    risk: "low"
    description: "View recent auth log"
    
  - command: "tail -n 50 /var/log/kern.log"
    risk: "low"
    description: "View recent kernel log"
    
  - command: "dmesg | tail -50"
    risk: "low"
    description: "View recent kernel messages"
    
  - command: "journalctl -n 50"
    risk: "low"
    description: "View recent journal entries"
    
  - command: "journalctl -p err -n 20"
    risk: "low"
    description: "View recent errors"
    
  - command: "last -10"
    risk: "low"
    description: "View recent logins"
    
  - command: "lastlog"
    risk: "low"
    description: "View last login times"

# ═══════════════════════════════════════════
# PROCESS MANAGEMENT
# ═══════════════════════════════════════════
processes:
  - command: "ps aux"
    risk: "low"
    description: "List all processes"
    
  - command: "pgrep -a {process}"
    risk: "low"
    description: "Find process by name"
    
  - command: "pstree"
    risk: "low"
    description: "Display process tree"

# ═══════════════════════════════════════════
# FILE INSPECTION (Read-Only)
# ═══════════════════════════════════════════
files:
  - command_pattern: "ls -la {path}"
    risk: "low"
    description: "List directory contents"
    blocked_paths:
      - "/root"
      - "/etc/shadow"
      - "/etc/passwd-"
    
  - command_pattern: "cat {file}"
    risk: "low"
    description: "View file contents"
    allowed_paths:
      - "/etc/"
      - "/var/log/"
      - "/home/"
      - "/opt/"
    blocked_files:
      - "/etc/shadow"
      - "/etc/gshadow"
      - "*.key"
      - "*.pem"
      - "*password*"
    
  - command_pattern: "head -n 50 {file}"
    risk: "low"
    description: "View first 50 lines"
    
  - command_pattern: "tail -n 50 {file}"
    risk: "low"
    description: "View last 50 lines"
    
  - command_pattern: "wc -l {file}"
    risk: "low"
    description: "Count lines in file"
    
  - command_pattern: "file {path}"
    risk: "low"
    description: "Determine file type"
    
  - command_pattern: "stat {path}"
    risk: "low"
    description: "Display file status"

# ═══════════════════════════════════════════
# PACKAGE MANAGEMENT (Query Only)
# ═══════════════════════════════════════════
packages:
  - command: "dpkg -l"
    risk: "low"
    description: "List installed packages"
    
  - command_pattern: "dpkg -l | grep {package}"
    risk: "low"
    description: "Search installed packages"
    
  - command_pattern: "apt-cache show {package}"
    risk: "low"
    description: "Show package details"
    
  - command: "apt list --upgradable"
    risk: "low"
    description: "List upgradable packages"

# ═══════════════════════════════════════════
# PACKAGE MANAGEMENT (Install/Update) - Medium Risk
# ═══════════════════════════════════════════
packages_modify:
  - command: "sudo apt update"
    risk: "medium"
    description: "Update package lists"
    requires_confirmation: true
    
  - command_pattern: "sudo apt install -y {package}"
    risk: "medium"
    description: "Install a package"
    requires_confirmation: true
    allowed_packages:
      - "htop"
      - "vim"
      - "nano"
      - "curl"
      - "wget"
      - "git"
      - "python3"
      - "python3-pip"

# ═══════════════════════════════════════════
# BLACKLIST - NEVER EXECUTE
# ═══════════════════════════════════════════
blacklist:
  patterns:
    - "rm -rf"
    - "rm -r /"
    - "mkfs"
    - "dd if="
    - ":(){:|:&};:"
    - "chmod -R 777"
    - "chmod 777 /"
    - "> /dev/sda"
    - "mv /* "
    - "wget * | sh"
    - "curl * | sh"
    - ":(){ :|:& };:"
    - "echo * > /etc/passwd"
    - "echo * > /etc/shadow"
    - "iptables -F"
    - "iptables -X"
    - "shutdown"
    - "reboot"
    - "init 0"
    - "init 6"
    - "halt"
    - "poweroff"
    
  keywords:
    - "format"
    - "destroy"
    - "wipe"
    - "nuke"
